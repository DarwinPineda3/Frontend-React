import React from 'react';
import {
  Box,
  Button,
  Typography,
  Container,
} from '@mui/material';
import { useDispatch } from 'src/store/Store';
import { createMalwareAnalysis, editMalwareAnalysis } from 'src/store/sections/malware-analysis/MalwareAnalysisSlice';
// import { MalwareAnalysisType } from 'src/types/malwareAnalysis/MalwareAnalysis';
import { useFormik } from 'formik';
import * as Yup from 'yup';
import Thumbnail from './MalwareAnalysisThumbnail';
import { useTranslation } from 'react-i18next';

interface Props {
    // malwareAnalysis?: MalwareAnalysisType; // Optional for edit
    malwareAnalysis?: any; // Optional for edit
    onSubmit: (message: string, severity: 'success' | 'info' | 'warning' | 'error') => void; // Callback after submission
}

const CreateUpdateMalwareAnalysis: React.FC<Props> = ({ malwareAnalysis, onSubmit }) => {
  const dispatch = useDispatch();
  const { t } = useTranslation();
  // Formik setup with Yup validation schema
  const formik = useFormik({
    initialValues: {
      file: null
    },
    validationSchema: Yup.object({
      file: Yup.string().required(t("malware.file_is_required")),
    }),
    onSubmit: (values) => {
      const newMalwareAnalysis: any = {
        ...values,
        id: malwareAnalysis?.id || undefined, // Only include `id` if updating
      };

      if (malwareAnalysis) {
        dispatch(editMalwareAnalysis(newMalwareAnalysis));
        onSubmit(t("malware.malware_analysis_updated_successfully"), 'success'); // Show success message for update
      } else {
        dispatch(createMalwareAnalysis(newMalwareAnalysis));
        onSubmit(t("malware.malware_analysis_created_successfully"), 'success'); // Show success message for create
      }
    },
  });

  return (
    <Container maxWidth="sm">
      <Box component="form" onSubmit={formik.handleSubmit} noValidate>
        <Typography variant="h5" gutterBottom>
          {malwareAnalysis ? t("malware.edit_malware_analysis") : t("malware.create_malware_analysis")}
        </Typography>

        <Thumbnail />

        <Box mt={2}>
          <Button type="submit" variant="contained" color="primary" fullWidth>
            {malwareAnalysis ? t("malware.edit") : t("malware.create")}
          </Button>
        </Box>
      </Box>
    </Container>
  );
};

export default CreateUpdateMalwareAnalysis;